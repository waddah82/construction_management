[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 1,
  "modified": "2025-11-05 21:45:02.641110",
  "module": null,
  "name": "pmgt_pi",
  "script": "// Custom Script for Doctype: Purchase Invoice\r\nfrappe.ui.form.on('Purchase Invoice', {\r\n    onload: function(frm) {\r\n        handle_task_project_linking(frm);\r\n    },\r\n    \r\n    task: function(frm) {\r\n        if (frm.doc.task) {\r\n            frappe.db.get_value('Task', frm.doc.task, 'project', (r) => {\r\n                if (r && r.project) {\r\n                    frm.set_value('project', r.project);\r\n                    \r\n                } else {\r\n                    frm.set_value('project', \"\");\r\n                    \r\n                }\r\n            });\r\n            copy_task_to_all_rows(frm, frm.doc.task);\r\n        } \r\n        \r\n    },\r\n    project: function(frm) {\r\n        if (frm.doc.project) {\r\n            if (!frm.doc.task) copy_project_to_all_rows(frm, frm.doc.project);\r\n        } \r\n        \r\n    }\r\n   \r\n});\r\n\r\nfunction handle_task_project_linking(frm) {\r\n    var task_id = frm.doc.task;\r\n    var current_project_id = frm.doc.project ;\r\n        if (frm.doc.task) {\r\n            frappe.db.get_value('Task', frm.doc.task, 'project', (r) => {\r\n                if (r && r.project) {\r\n                    frm.set_value('project', r.project);\r\n                    \r\n                } else {\r\n                    frm.set_value('project', \"\");\r\n                    \r\n                }\r\n            });\r\n            copy_task_to_all_rows(frm, frm.doc.task);\r\n        } \r\n        else {\r\n            if (!current_project_id) return;\r\n            copy_project_to_all_rows(frm, current_project_id);\r\n        }\r\n}\r\n\r\nfunction copy_task_to_all_rows(frm, task_id) {\r\n    let changed = false;\r\n    \r\n    if (frm.doc.items) { \r\n        frm.doc.items.forEach(function(item) {\r\n            if (!item.task) {\r\n                item.task = task_id; \r\n                changed = true;\r\n            }\r\n        });\r\n        \r\n        if (changed) {\r\n            frm.refresh_field('items'); \r\n        }\r\n    }\r\n}\r\n\r\nfunction copy_project_to_all_rows(frm, project_id) {\r\n    let changed = false;\r\n    \r\n    if (frm.doc.items) { \r\n        frm.doc.items.forEach(function(item) {\r\n            if (!item.project) {\r\n                item.project = project_id; \r\n                changed = true;\r\n            }\r\n        });\r\n        \r\n        if (changed) {\r\n            frm.refresh_field('items'); \r\n        }\r\n    }\r\n}\r\n\r\n// Custom Script for Doctype: Purchase Invoice Item\r\nfrappe.ui.form.on('Purchase Invoice Item', {\r\n    items_add: function(frm, cdt, cdn) { \r\n        let row = locals[cdt][cdn];\r\n        //let task_id = frm.doc.task;\r\n        let project_id = frm.doc.project;\r\n\r\n        if (frm.doc.task && !row.task) {\r\n            row.task = frm.doc.task;\r\n        }\r\n        else \r\n        if (project_id && !row.project) {\r\n            row.project = project_id;\r\n        }\r\n        frm.refresh_field('items'); \r\n    },\r\n    task: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        if (row.task) {\r\n            frappe.db.get_value('Task', row.task, 'project', (r) => {\r\n                if (r && r.project) {\r\n                    frappe.model.set_value(cdt, cdn, 'project', r.project);\r\n                } else {\r\n                    frappe.model.set_value(cdt, cdn, 'project', \"\");\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Expense Claim",
  "enabled": 1,
  "modified": "2025-11-04 00:46:02.382803",
  "module": null,
  "name": "pmgt_EC",
  "script": "\nfrappe.ui.form.on('Expense Claim', {\n    onload: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    task: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    project: function(frm) {\n        handle_task_project_linking(frm);\n        \n    }\n});\n\n\nfunction handle_task_project_linking(frm) {\n    var task_id = frm.doc.task || \"\";\n\n    if (!task_id){\n        if (frm.doc.project) {\n            copy_project_to_all_rows(frm, frm.doc.project);\n        }\n        return; \n    }\n    \n    if (!frm.doc.project) {\n         frappe.db.get_value('Task', task_id, 'project', function(r) {\n            if (r.project) {\n                var project_id = r.project;\n                \n                if (!frm.doc.project) {\n                    frm.set_value('project', project_id);\n                }\n                \n                copy_task_and_project_to_all_rows(frm, task_id, project_id);\n            }\n        });\n    }\n    \n    if (frm.doc.project) {\n         copy_task_and_project_to_all_rows(frm, task_id, frm.doc.project);\n    }\n}\n\nfunction copy_task_and_project_to_all_rows(frm, task_id, project_id) {\n    let changed = false;\n    \n    if (frm.doc.expenses) { \n        frm.doc.expenses.forEach(function(item) {\n            if (!item.task) {\n                item.task = task_id; \n                changed = true;\n            }\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('expenses');\n        }\n    }\n}\n\nfunction copy_project_to_all_rows(frm, project_id) {\n    let changed = false;\n    \n    if (frm.doc.expenses) { \n        frm.doc.expenses.forEach(function(item) {\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('expenses');\n        }\n    }\n}\n\nfrappe.ui.form.on('Expense Claim Detail', {\n    expenses_add: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        let task_id = frm.doc.task;\n        let project_id = frm.doc.project;\n\n        if (task_id) row.task = task_id;\n        if (project_id) row.project = project_id;\n\n        frm.refresh_field('expenses');\n    }\n});\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Timesheet",
  "enabled": 1,
  "modified": "2025-11-05 21:47:15.914925",
  "module": null,
  "name": "pmgt_TS",
  "script": "// Custom Script for Doctype: Timesheet\r\nfrappe.ui.form.on('Timesheet', {\r\n    onload: function(frm) {\r\n        handle_task_project_linking(frm);\r\n    },\r\n    \r\n    task: function(frm) {\r\n        if (frm.doc.task) {\r\n            frappe.db.get_value('Task', frm.doc.task, 'project', (r) => {\r\n                if (r && r.project) {\r\n                    frm.set_value('parent_project', r.project);\r\n                    \r\n                } else {\r\n                    frm.set_value('parent_project', \"\");\r\n                    \r\n                }\r\n            });\r\n            copy_task_to_all_rows(frm, frm.doc.task);\r\n        } \r\n        \r\n    },\r\n    parent_project: function(frm) {\r\n        if (frm.doc.parent_project) {\r\n            if (!frm.doc.task) copy_project_to_all_rows(frm, frm.doc.parent_project);\r\n        } \r\n        \r\n    }\r\n   \r\n});\r\n\r\nfunction handle_task_project_linking(frm) {\r\n    var task_id = frm.doc.task;\r\n    var current_project_id = frm.doc.parent_project ;\r\n        if (frm.doc.task) {\r\n            frappe.db.get_value('Task', frm.doc.task, 'project', (r) => {\r\n                if (r && r.project) {\r\n                    frm.set_value('parent_project', r.project);\r\n                    \r\n                } else {\r\n                    frm.set_value('parent_project', \"\");\r\n                    \r\n                }\r\n            });\r\n            copy_task_to_all_rows(frm, frm.doc.task);\r\n        } \r\n        else {\r\n            if (!current_project_id) return;\r\n            copy_project_to_all_rows(frm, current_project_id);\r\n        }\r\n}\r\n\r\nfunction copy_task_to_all_rows(frm, task_id) {\r\n    let changed = false;\r\n    \r\n    if (frm.doc.time_logs) { \r\n        frm.doc.time_logs.forEach(function(item) {\r\n            if (!item.task) {\r\n                item.task = task_id; \r\n                changed = true;\r\n            }\r\n        });\r\n        \r\n        if (changed) {\r\n            frm.refresh_field('time_logs'); \r\n        }\r\n    }\r\n}\r\n\r\nfunction copy_project_to_all_rows(frm, project_id) {\r\n    let changed = false;\r\n    \r\n    if (frm.doc.time_logs) { \r\n        frm.doc.time_logs.forEach(function(item) {\r\n            if (!item.project) {\r\n                item.project = project_id; \r\n                changed = true;\r\n            }\r\n        });\r\n        \r\n        if (changed) {\r\n            frm.refresh_field('time_logs'); \r\n        }\r\n    }\r\n}\r\n\r\n// Custom Script for Doctype: Timesheet  Detail\r\nfrappe.ui.form.on('Timesheet Detail', {\r\n    time_logs_add: function(frm, cdt, cdn) { \r\n        let row = locals[cdt][cdn];\r\n        let task_id = frm.doc.task;\r\n        let project_id = frm.doc.parent_project;\r\n\r\n        if (task_id && !row.task) {\r\n            row.task = task_id;\r\n        }\r\n        else \r\n        if (project_id && !row.project) {\r\n            row.project = project_id;\r\n        }\r\n        frm.refresh_field('time_logs'); \r\n    },\r\n    task: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        if (row.task) {\r\n            frappe.db.get_value('Task', row.task, 'project', (r) => {\r\n                if (r && r.project) {\r\n                    frappe.model.set_value(cdt, cdn, 'project', r.project);\r\n                } else {\r\n                    frappe.model.set_value(cdt, cdn, 'project', \"\");\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 1,
  "modified": "2025-11-03 23:40:40.608324",
  "module": null,
  "name": "pmgt_MR",
  "script": "\nfrappe.ui.form.on('Material Request', {\n    onload: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    task: function(frm) {\n        handle_task_project_linking(frm);\n    \n    \n    }\n});\n\nfunction handle_task_project_linking(frm) {\n    var task_id = frm.doc.task;\n    var current_project_id = frm.doc.project || \"\"; \n\n    if (!task_id) return;\n\n    if (!current_project_id) {\n         frappe.db.get_value('Task', task_id, 'project', function(r) {\n            if (r.project) {\n                var project_id = r.project;\n                \n               \n                copy_task_and_project_to_all_rows(frm, task_id, project_id);\n            }\n        });\n    }\n    \n  \n}\n\nfunction copy_task_and_project_to_all_rows(frm, task_id, project_id) {\n    let changed = false;\n    \n    // ÿßŸÜÿ™ÿ®Ÿá: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÅÿ±ÿπŸä ŸáŸà 'items'\n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.task) {\n                item.task = task_id; \n                changed = true;\n            }\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items'); \n        }\n    }\n}\n\n\nfrappe.ui.form.on('Material Request Item', {\n    items_add: function(frm, cdt, cdn) { \n        let row = locals[cdt][cdn];\n        let task_id = frm.doc.task;\n\n        if (task_id && !row.task) {\n            row.task = task_id;\n\n            // üîπ ÿßÿ¨ŸÑÿ® ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ŸÖŸÜ ÿßŸÑÿ™ÿßÿ≥ŸÉ\n            frappe.db.get_value('Task', task_id, 'project', function(r) {\n                if (r.project) {\n                    row.project = r.project;\n                    frm.refresh_field('items');\n                }\n            });\n        } else {\n            frm.refresh_field('items');\n        }\n    },\n\n    task: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.task) {\n            frappe.db.get_value('Task', row.task, 'project', function(r) {\n                if (r.project) {\n                    row.project = r.project;\n                    frm.refresh_field('items');\n                }\n            });\n        }\n    }\n});\n\n\nfrappe.ui.form.on('Material Request Item11', {\n    items_add: function(frm, cdt, cdn) { \n        let row = locals[cdt][cdn];\n        let task_id = frm.doc.task;\n\n\n        if (task_id && !row.task) {\n            row.task = task_id;\n        }\n        frm.refresh_field('items'); \n    },\n    task: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.task) {\n            frappe.db.get_value('Task', row.task, 'project', function(r) {\n                if (r.project) {\n                    let project_id = r.project;\n                    if (!row.project) {\n                        row.project = project_id;\n                    }\n                }\n            });\n            frm.refresh_field('items');\n        }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-11-04 00:53:34.811583",
  "module": null,
  "name": "mgt_SI",
  "script": "frappe.ui.form.on('Sales Invoice', {\n    onload: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    task: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    project: function(frm) {\n        handle_task_project_linking(frm);\n    }\n});\n\nfunction handle_task_project_linking(frm) {\n    var task_id = frm.doc.task;\n    var current_project_id = frm.doc.project;\n\n    if (!task_id){\n        if (frm.doc.project) {\n            copy_project_to_all_rows(frm, frm.doc.project);\n        }\n        return; \n    }\n\n    if (!current_project_id) {\n         frappe.db.get_value('Task', task_id, 'project', function(r) {\n            if (r.project) {\n                var project_id = r.project;\n                \n                if (!frm.doc.project) {\n                    frm.set_value('project', project_id);\n                }\n                \n                copy_task_and_project_to_all_rows(frm, task_id, project_id);\n            }\n        });\n    }\n\n    if (current_project_id) {\n         copy_task_and_project_to_all_rows(frm, task_id, current_project_id);\n    }\n}\n\nfunction copy_task_and_project_to_all_rows(frm, task_id, project_id) {\n    let changed = false;\n    \n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.task) {\n                item.task = task_id; \n                changed = true;\n            }\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items'); \n        }\n    }\n}\n\n\nfunction copy_project_to_all_rows(frm, project_id) {\n    let changed = false;\n    \n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items');\n        }\n    }\n}\n\n\n\n\nfrappe.ui.form.on('Sales Invoice Item', {\n    items_add: function(frm, cdt, cdn) { \n        let row = locals[cdt][cdn];\n        let task_id = frm.doc.task;\n        let project_id = frm.doc.project;\n\n        if (task_id && !row.task) {\n            row.task = task_id;\n        }\n        if (project_id && !row.project) {\n            row.project = project_id;\n        }\n\n        frm.refresh_field('items'); \n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2025-11-04 00:52:58.200313",
  "module": null,
  "name": "mgt_PO",
  "script": "frappe.ui.form.on('Purchase Order', {\n    onload: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    task: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    project: function(frm) {\n        handle_task_project_linking(frm);\n    }\n});\n\nfunction handle_task_project_linking(frm) {\n    var task_id = frm.doc.task;\n    var current_project_id = frm.doc.project;\n\n    if (!task_id){\n        if (frm.doc.project) {\n            copy_project_to_all_rows(frm, frm.doc.project);\n        }\n        return; \n    }\n\n    if (!current_project_id) {\n         frappe.db.get_value('Task', task_id, 'project', function(r) {\n            if (r.project) {\n                var project_id = r.project;\n                \n                if (!frm.doc.project) {\n                    frm.set_value('project', project_id);\n                }\n                \n                copy_task_and_project_to_all_rows(frm, task_id, project_id);\n            }\n        });\n    }\n\n    if (current_project_id) {\n         copy_task_and_project_to_all_rows(frm, task_id, current_project_id);\n    }\n}\n\nfunction copy_task_and_project_to_all_rows(frm, task_id, project_id) {\n    let changed = false;\n    \n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.task) {\n                item.task = task_id; \n                changed = true;\n            }\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items'); \n        }\n    }\n}\n\n\nfunction copy_project_to_all_rows(frm, project_id) {\n    let changed = false;\n    \n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items');\n        }\n    }\n}\n\n\n\n\n\nfrappe.ui.form.on('Purchase Order Item', {\n    items_add: function(frm, cdt, cdn) { \n        let row = locals[cdt][cdn];\n        let task_id = frm.doc.task;\n        let project_id = frm.doc.project;\n\n        if (task_id && !row.task) {\n            row.task = task_id;\n        }\n        if (project_id && !row.project) {\n            row.project = project_id;\n        }\n\n        frm.refresh_field('items'); \n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-11-05 22:17:13.055130",
  "module": null,
  "name": "pmgt_SE",
  "script": "frappe.ui.form.on('Stock Entry', {\n    onload: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    task: function(frm) {\n        handle_task_project_linking(frm);\n    },\n    \n    project: function(frm) {\n        handle_task_project_linking(frm);\n    }\n});\n\nfunction handle_task_project_linking(frm) {\n    var task_id = frm.doc.task;\n    var current_project_id = frm.doc.project;\n\n    if (!task_id){\n        if (frm.doc.project) {\n            copy_project_to_all_rows(frm, frm.doc.project);\n        }\n        return; \n    }\n\n    if (!current_project_id) {\n         frappe.db.get_value('Task', task_id, 'project', function(r) {\n            if (r.project) {\n                var project_id = r.project;\n                \n                if (!frm.doc.project) {\n                    frm.set_value('project', project_id);\n                }\n                \n                copy_task_and_project_to_all_rows(frm, task_id, project_id);\n            }\n        });\n    }\n\n    if (current_project_id) {\n         copy_task_and_project_to_all_rows(frm, task_id, current_project_id);\n    }\n}\n\nfunction copy_task_and_project_to_all_rows(frm, task_id, project_id) {\n    let changed = false;\n    \n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.task) {\n                item.task = task_id; \n                changed = true;\n            }\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items'); \n        }\n    }\n}\n\n\nfunction copy_project_to_all_rows(frm, project_id) {\n    let changed = false;\n    \n    if (frm.doc.items) { \n        frm.doc.items.forEach(function(item) {\n            if (!item.project) {\n                item.project = project_id;\n                changed = true;\n            }\n        });\n        \n        if (changed) {\n            frm.refresh_field('items');\n        }\n    }\n}\n\n\nfrappe.ui.form.on('Stock Entry Detail', {\n    items_add: function(frm, cdt, cdn) { \n        let row = locals[cdt][cdn];\n        let task_id = frm.doc.task;\n        let project_id = frm.doc.project;\n\n        if (task_id && !row.task) {\n            row.task = task_id;\n        }\n        if (project_id && !row.project) {\n            row.project = project_id;\n        }\n\n        frm.refresh_field('items'); \n    }\n});\n\n",
  "view": "Form"
 }
]